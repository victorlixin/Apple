

sdi(7)                                                     sdi(7)

DDeessccrriippttiioonn
       The commands that are supported by various SDI devices are
       documented in the following sections.

   PPaassss--tthhrroouugghh iiooccttll ccoommmmaannddss
       SCSI Device Interface Host Bus Adapters (HBA)s  that  sup-
       port  the SDI pass-through interface must support the fol-
       lowing commands: Sends a pass-through command  (SCSI  con-
       trol  block) to a target controller, bypassing the associ-
       ated target driver.  Resets the SCSI bus.  Returns the bus
       name and the device driver name of a specific device.  For
       a 80386-based  computer,  used  to  determine  the  Driver
       Interface Version supported by the driver.  It returns the
       ver_no structure defined in the header file.

   DDiisskk iiooccttll ccoommmmaannddss
       The calls supported by the driver to control  the  reading
       and  writing  of data to disk are as follows: Reserves for
       exclusive use a SCSI disk for a processor.  Returns device
       reservation status.

       The  following  commands  are  used  to  identify a target
       driver and to get pass-through major and minor numbers for
       a  target  device:  See Returns the pass-through major and
       minor numbers to the calling utility, allowing creation of
       a   pass-through   special  device  file.   Starting  with
       &uw710;, applications should  use  the  SCSI  pass-through
       interface  documented  on  and  to  send  commands to SCSI
       Device Interface Host Bus Adapters (HBA)s that support the
       SDI pass-through interface.  Application use of the B_GET-
       TYPE and B_GETDEV ioctl commands for this purpose is main-
       tained  for compatibility with existing applications only.

   TTaappee iiooccttll ccoommmmaannddss
       The calls that are supported  by  the  driver  are  listed
       below.

       The  following commands are used to control tape position-
       ing: Positions the tape forward or backward arg (see  num-
       ber  of  file  marks  from  the current tape head position
       toward the End- of-Tape (EOT) or Beginning-of-Tape  (BOT).
       Forward movement of the tape leaves the tape positioned on
       the EOT side of a file mark or at EOT, and backwards move-
       ment  leaves the tape positioned on the BOT side of a file
       mark or at BOT. A backward  positioning  operation  causes
       the next read to return 0 bytes unless arg is greater than
       the number of file marks between the current position  and
       BOT.  The value of arg must be a positive integer. A value
       of 0 is not considered an error, but does  not  result  in
       any tape movement.  Positions the tape forward or backward
       arg number of blocks from the current tape  head  position
       toward  the EOT or BOT.  Upon command completion, the tape
       head is positioned in the gap between tape  blocks.  Thus,
       skipping  a  block forward advances to the next block, and

                                                                1

sdi(7)                                                     sdi(7)

       skipping a block backward retreats to the last block.  The
       value of arg must be a positive integer.  Upon any attempt
       to skip over a file mark, the tape is  positioned  on  the
       EOT/BOT  side  of  the  file  mark for forward or backward
       movement, and the positioning operation ceases.   A  value
       of  0  is  not considered an error, but does not result in
       any tape movement.  Rewinds the tape from the current tape
       position to the BOT. Two file marks are written before the
       rewind if the tape has been written.   This  command  does
       not  unload  the tape.  Writes file marks to the tape. The
       value of arg defines the number of consecutive file  marks
       to  be  written.  If  an  error  occurs while writing file
       marks, the number of file marks that  have  been  success-
       fully  written  is indeterminate.  Positions the tape just
       beyond the last file mark.  Defines the recording  density
       of  the  tape  media  being used. The numeric density code
       used is as defined in the SCSI-2 specification.  Locks  or
       unlocks  the tape in the drive. T_PREVMV locks the tape by
       means of a mechanical lock  or  an  LED  to  indicate  the
       device is in use.

       T_ALLOMV unlocks the tape in the drive locked by T_PREVMV.

       These ioctls are supported only on devices that  implement
       appropriate  tape  lock features. For example, ICT devices
       are among those which do not support this  ioctl.   T_LOAD
       loads the tape media and positions the tape BOT.

       T_UNLOAD  unloads  the  tape. Most devices rewind the tape
       before unloading. Devices capable  of  ejecting  the  tape
       will  do  so in response to this command.  Erases the tape
       from BOT to EOT. If the tape is not positioned at BOT, the
       tape  is  positioned  at  BOT  before performing the erase
       function.  T_RDBLKLEN  returns  the  minimum  and  maximum
       block  lengths  supported  by  the tape device. T_WRBLKLEN
       sets the current block length for the device. The value of
       arg  must  be  of  type  struct  blklen,  and max_blen and
       min_blen set to the desired block length  for  T_WRBLKLEN.
       See  for  more  information.   Retensions  the tape in the
       drive, running the tape at high speed from BOT to EOT, and
       then  back  again. The retension operation leaves the tape
       positioned at BOT.  The following commands are used by the
       st01  driver  to control data compression characteristics:
       T_GETCOMP returns the data compression characteristics  of
       the tape device. T_SETCOMP sets the data compression char-
       acteristics of the  tape  device.  The  value  of  arg  is
       defined as: compression off and decompression off compres-
       sion on and decompression off compression off  and  decom-
       pression  on  compression on and decompression on The fol-
       lowing additional ioctls are  supported  for  floppy  tape
       drives  using  the fdha and cmtrak HBA drivers: Resets the
       drive.  Formats cartridge.  The  third  parameter  of  the
       system  call should pass a pointer to the following struc-
       ture:  struct   ft_format   {        char   tape_name[44];

                                                                2

sdi(7)                                                     sdi(7)

            unchar   tape_length;       ulong  tape_fmt_time;  };
       tape_name is any ASCII string, left-justified  and  space-
       filled.  tape_length takes the following values::
       ----------------
       length     code
       ----------------
       205 ft     0x01
       307.5 ft   0x02
       1100 ft    0x04

       tape_fmt_time  is  the time at which format is started and
       is coded as follows:
       ---------------------------------------------
       bits    value
       ---------------------------------------------
       31-25   0 - 127 = 1970 - 2097
       24-0    month, day, hour, minute, and second

       Let MO be the month (0-11), DY the day (0-30), HR the hour
       (0-23),  MN  the  minute (0-59), and SC the second (0-59).
       tape_fmt_time then contains: SC + 60 * (MN + 60 * (HR + 24
       *  (DY  +  31  * MO))) Reads or writes the volume table of
       contents (VTBL) on a cartridge. The argument expected is a
       pointer to the structure: struct ft_vtbl_rw {       unchar
       io_type;         caddr_t  vtbl_data;
              unsigned num_vtbl_entry; }; 0x01 for read, 0x02 for
       write should always be 29K number of VTBL entries read  or
       written.

   CCDD--RROOMM iiooccttll ccoommmmaannddss
       The  commands  that are supported by the driver are listed
       below.  Many of these ioctl commands provide a  convenient
       method  for  sending  one of the preselected SCSI commands
       directly to the drive.  SCSI commands not explicitly  sup-
       ported  by  the sc01 driver can be sent to the drive using
       the pass-through facility provided by the SDI host adapter
       driver.  For an example, see

       The  following ioctls are used to identify a target driver
       and to get a pass-through major and  minor  number  for  a
       target  device:  See Returns the major and minor number of
       the pass-through device for  the  CD-ROM  drive  (see  for
       details).   Starting with &uw710;, applications should use
       the SCSI pass-through interface documented on and to  send
       commands to SCSI Device Interface Host Bus Adapters (HBA)s
       that support the SDI pass-through interface.   Application
       use  of the B_GETTYPE and B_GETDEV ioctl commands for this
       purpose is  maintained  for  compatibility  with  existing
       applications only.

       The   following  ioctls  cause  the  appropriate  Group-0,
       Group-1, or Group-6  SCSI  commands  to  be  sent  to  the
       device.  These commands are defined by the SCSI bus speci-
       fication  and  should  also  be  described  in  the   SCSI

                                                                3

sdi(7)                                                     sdi(7)

       Interface  section  of  the reference manual supplied with
       your CD-ROM drive.

       The Group-0 ioctls are: Sends a Test Unit Ready command to
       the  device.  Sends a Rezero Device command to the device.
       Sends a Seek command to the device.  Sends an Inquiry com-
       mand  to the device and returns the resulting data back to
       the caller.  The passed buffer for C_INQUIR needs to be at
       least  IDENT_SZ  (36) bytes. Otherwise, an underflow error
       occurs and the command fails.  Sends a Start Unit  command
       to  the  device.  Sends a Stop Unit command to the device.
       Sends a Prevent  Media  Removal  command  to  the  device.
       Sends an Allow Media Removal command to the device.

       The  Group-1  ioctls are: Sends a Read Capacity command to
       the device and returns the data sent by the drive.

       The Group-6 ioctls are: Sends an Audio Search  command  to
       the  device.   Sends  a  Play Audio command to the device.
       Sends a Still command to the device.  Sends  a  Tray  Open
       command  to the device.  Sends a Tray Close command to the
       device.  The Group-6 ioctls support only the  drives  that
       are  software  compatible  with the Toshiba XM-3201B.  The
       following ioctl is also  supported  by  the  sc01  driver:
       Returns  the  number  of  sub-devices  supported  by  this
       driver.

   MMeeddiiaa cchhaannggeerr iiooccttll ccoommmmaannddss
       The calls that are supported by the driver to control  the
       medium changer operations are as follows: Used to exchange
       the currently loaded media with  media  from  a  specified
       slot.   The currently loaded media is placed back into the
       magazine slot from which it was loaded.  The command  used
       to  implement this ioctl is optional; therefore, this com-
       mand's functionality is medium changer dependent.  Used to
       initialize  the  medium  changer's status.  This operation
       should be performed whenever a new magazine  is  inserted,
       or  the  medium changer's front panel controls are used to
       manipulate the mechanism.  Used to move a  medium  element
       from  one  storage  element  location to another.  Used to
       position the medium changer to a specific storage  element
       location.   This is an optional SCSI command.  The command
       used to implement this ioctl is optional; therefore,  this
       command's   functionality  is  medium  changer  dependent.
       Reports the number of storage  element  locations  in  the
       currently  loaded  magazine.   Reports  the  status of the
       medium changer device.  The report includes the total num-
       ber of storage element locations, status (Loaded or Empty)
       of each storage element location, and  status  (Loaded  or
       Empty)  of the data transfer element (drive).  Reports the
       storage element number that  the  currently  loaded  media
       came  from.   Used  to  prevent media or magazine removal.
       The command used to  implement  this  ioctl  is  optional;
       therefore,  this command's functionality is medium changer

                                                                4

sdi(7)                                                     sdi(7)

       dependent.  Used to allow media or magazine removal.   The
       command  used  to implement this ioctl is optional; there-
       fore,  this  command's  functionality  is  medium  changer
       dependent.    Reserves   a  SCSI  disk  for  a  processor.
       Releases a SCSI disk from a processor.   See  Returns  the
       pass-through  major and minor numbers to the calling util-
       ity, allowing creation of a  pass-through  special  device
       file.   Starting with &uw710;, applications should use the
       SCSI pass-through interface documented on and to send com-
       mands  to  SCSI  Device Interface Host Bus Adapters (HBA)s
       that support the SDI pass-through interface.   Application
       use  of the B_GETTYPE and B_GETDEV ioctl commands for this
       purpose is  maintained  for  compatibility  with  existing
       applications only.

   WWOORRMM iiooccttll ccoommmmaannddss
       The  calls  that  are  supported  by the driver are listed
       below.  Many of the supported ioctl calls provide a conve-
       nient  method for sending one of the preselected SCSI com-
       mands directly to the drive.  SCSI commands not explicitly
       supported by sw01 can be sent to the drive using the pass-
       through facility provided by the SDI host adapter  driver.

       The  following ioctl calls are defined and required by the
       SDI interface: See Returns the major and minor  number  of
       the  pass-through device for the WORM drive.  Sends a SCSI
       Reserve command to the drive.  Sends a SCSI  Release  com-
       mand  to  the  drive.  Starting with &uw710;, applications
       should use the SCSI pass-through interface  documented  on
       and  to  send  commands  to SCSI Device Interface Host Bus
       Adapters (HBA)s that support the SDI  pass-through  inter-
       face.  Application use of the B_GETTYPE and B_GETDEV ioctl
       commands for this purpose is maintained for  compatibility
       with existing applications only.

       The  following  ioctl  calls  send the appropriate Group-0
       SCSI command to the device.  These commands are defined by
       the SCSI bus specification and should also be described in
       the SCSI interface section of the  reference  manual  sup-
       plied  with your WORM drive.  Sends a Test Unit Ready com-
       mand to the device.  Sends a Rezero Device command to  the
       device.   Sends  a  Seek  command to the device.  Sends an
       Inquiry command to the device, and returns  the  resulting
       data back to the calling process.  Sends a Start Unit com-
       mand to the device.  Sends a  Stop  Unit  command  to  the
       device.   Sends  a  Prevent  Media  Removal command to the
       device.  Sends an  Allow  Media  Removal  command  to  the
       device.

       The  following  ioctl  calls  send the appropriate Group-1
       SCSI command to the device.  The Group-1 SCSI commands are
       defined  by  the  SCSI standard and should be described in
       the SCSI interface section of the  reference  manual  sup-
       plied with your WORM drive.  Sends a Read Capacity command

                                                                5

sdi(7)                                                     sdi(7)

       to the device, and returns the data  sent  by  the  drive.
       Sends a Verify command to the device.

       The  following  ioctl  calls  send the appropriate Group-6
       SCSI command to the drive.  These  Group-6  SCSI  commands
       are  vendor  specific  and should be described in the SCSI
       interface section of the reference  manual  supplied  with
       your  drive.  Because the format of these SCSI commands is
       vendor-specific, these ioctl calls are supported  only  by
       products  compatible with the Toshiba D070 drive.  Sends a
       Stand-By Check command to the device.  Sends a  Load  Car-
       tridge  command  to the device.  Sends an Unload Cartridge
       command to the device.  Sends a Read Control Block command
       to the device.

       The  following  ioctl  calls  send the appropriate Group-7
       SCSI command to the drive.  Group-7 SCSI commands are ven-
       dor specific and should be described in the SCSI interface
       section of the reference manual supplied with your  drive.
       Since  the  format  of  these SCSI commands is vendor spe-
       cific, these ioctl calls are supported  only  by  products
       compatible  with  the  Toshiba  D070 drive.  Sends a Check
       command to the device.  Sends a Contrary Check command  to
       the device.

       The  following  ioctl calls are also supported by the sw01
       driver: Returns the number  of  sub-devices  supported  by
       this driver.

RReeffeerreenncceess

                                                                6

